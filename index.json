[{"content":"Mockitoå­¦ä¹ ç¬”è®°\næ¦‚è¦ Mockitoæ˜¯ä¸€ä¸ªå¸¸è§ç”¨äºmockä¾èµ–å¯¹è±¡çš„æµ‹è¯•å·¥å…·ï¼Œæœ¬æ–‡é‡ç‚¹è®²è§£Mockitoçš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ä»¥åŠå®ç°åŸç†ã€‚\nä½¿ç”¨æ–¹æ³• @Test public void testMockito() { //mock ä¸€ä¸ªå¯¹è±¡ ArrayList\u0026lt;String\u0026gt; urlList = Mockito.mock(ArrayList.class); /** *æ‰“å°mockå¯¹è±¡åï¼Œå¯ä»¥çœ‹åˆ°æ˜¯è¢«ä»£ç†çš„å¯¹è±¡ *java.util.ArrayList$$EnhancerByMockitoWithCGLIB$$c24a9da4 */ System.out.println(urlList.getClass().getName()); // stubæ‰“æ¡© when(urlList.size()).thenReturn(100); when(urlList.get(0)).thenReturn(\u0026quot;abc\u0026quot;); when(urlList.get(1)).thenReturn(\u0026quot;def\u0026quot;); String value0 = urlList.get(0); // abc String value1 = urlList.get(1); // def String value2 = urlList.get(2); // null int size = urlList.size(); // 100 // verifyè°ƒç”¨æ¬¡æ•° verify(urlList, times(2)).size(); //error } å¸¸ç”¨çš„åŠŸèƒ½ä¸»è¦æ˜¯stubæ‰“æ¡©å’ŒverifyéªŒè¯ã€‚\nstubç”¨äºå¯¹mockå¯¹è±¡è®¾ç½®çš„æ–¹æ³•å’Œå‚æ•°ï¼Œè¿”å›ç»™å®šçš„æ•°æ®ã€‚\nverifyç”¨äºæ£€æŸ¥mockå¯¹è±¡æ–¹æ³•çš„æ‰§è¡Œæƒ…å†µã€‚\nå®ç°åŸç† æœ¬æ–‡åŸºäºmockitoÂ 1.10.19ç‰ˆæœ¬\nè·Ÿè¸ªMockito.mockæ–¹æ³•ï¼Œå¾—åˆ°MockitoCoreçš„mockæ–¹æ³•\npublic \u0026lt;T\u0026gt; T mock(Class\u0026lt;T\u0026gt; typeToMock, MockSettings settings) { if (!MockSettingsImpl.class.isInstance(settings)) { throw new IllegalArgumentException( \u0026quot;Unexpected implementation of '\u0026quot; + settings.getClass().getCanonicalName() + \u0026quot;'\\n\u0026quot; + \u0026quot;At the moment, you cannot provide your own implementations that class.\u0026quot;); } MockSettingsImpl impl = MockSettingsImpl.class.cast(settings); MockCreationSettings\u0026lt;T\u0026gt; creationSettings = impl.confirm(typeToMock); // åˆ›å»ºmockå¯¹è±¡ T mock = mockUtil.createMock(creationSettings); mockingProgress.mockingStarted(mock, typeToMock); return mock; } è·Ÿè¸ªcreateMockæ–¹æ³•ï¼Œåˆ°MockUtilä¸­çš„createMockï¼š\npublic \u0026lt;T\u0026gt; T createMock(MockCreationSettings\u0026lt;T\u0026gt; settings) { // åˆ›å»ºhandler MockHandler mockHandler = new MockHandlerFactory().create(settings); // è°ƒç”¨cglibåˆ›å»ºmockå¯¹è±¡ T mock = mockMaker.createMock(settings, mockHandler); Object spiedInstance = settings.getSpiedInstance(); if (spiedInstance != null) { new LenientCopyTool().copyToMock(spiedInstance, mock); } return mock; } é€šè¿‡cglibåˆ›å»ºmockå¯¹è±¡ï¼š\npublic \u0026lt;T\u0026gt; T createMock(MockCreationSettings\u0026lt;T\u0026gt; settings, MockHandler handler) { InternalMockHandler mockitoHandler = cast(handler); new AcrossJVMSerializationFeature().enableSerializationAcrossJVM(settings); return new ClassImposterizer(new InstantiatorProvider().getInstantiator(settings)).imposterise( new MethodInterceptorFilter(mockitoHandler, settings), settings.getTypeToMock(), settings.getExtraInterfaces()); } Mockitoä½¿ç”¨cglibè¿™ä¸ªæ¡†æ¶æ¥ç”Ÿæˆä»£ç†ç±»ä»£ç ï¼Œç„¶åç”¨ClassLoaderè¿›è¡ŒåŠ è½½ï¼Œå°†MethodInterceptorFilterä½œä¸ºä»£ç†ç±»çš„æ‹¦æˆªå™¨ã€‚\n@Override public Object intercept(Object proxy, Method method, Object[] args, MethodProxy methodProxy) throws Throwable { /** .... **/ Invocation invocation = new InvocationImpl(proxy, mockitoMethod, args, SequenceNumber.next(), realMethod); // æœ€ç»ˆè°ƒç”¨InternalMockHandler.handleæ–¹æ³• return handler.handle(invocation); } stub stubå¯ä»¥æŒ‡å®šæ–¹æ³•è¿”å›å€¼ï¼Œæˆ‘ä»¬è·Ÿè¸ªwhenæ–¹æ³•æ¥çœ‹çœ‹å®ƒçš„å®ç°ã€‚\nMockitoCore.whenæ–¹æ³•\npublic \u0026lt;T\u0026gt; OngoingStubbing\u0026lt;T\u0026gt; when(T methodCall) { // æ ‡è®°stubå¼€å§‹ mockingProgress.stubbingStarted(); return (OngoingStubbing) stub(); } public IOngoingStubbing stub() { IOngoingStubbing stubbing = mockingProgress.pullOngoingStubbing(); if (stubbing == null) { mockingProgress.reset(); reporter.missingMethodInvocation(); } return stubbing; } whenæ–¹æ³•å°±æ˜¯è¿”å›ä¸Šæ¬¡mockæ–¹æ³•è°ƒç”¨å°è£…å¥½çš„OngoingStubbingã€‚\nthenReturn // OngoingStubbingImpl public OngoingStubbing\u0026lt;T\u0026gt; thenAnswer(Answer\u0026lt;?\u0026gt; answer) { if(!invocationContainerImpl.hasInvocationForPotentialStubbing()) { new Reporter().incorrectUseOfApi(); } invocationContainerImpl.addAnswer(answer); return new ConsecutiveStubbing\u0026lt;T\u0026gt;(invocationContainerImpl); } // InvocationContainerImpl public void addAnswer(Answer answer, boolean isConsecutive) { // è·å–stubçš„è°ƒç”¨ Invocation invocation = invocationForStubbing.getInvocation(); mockingProgress.stubbingCompleted(invocation); AnswersValidator answersValidator = new AnswersValidator(); answersValidator.validate(answer, invocation); synchronized (stubbed) { if (isConsecutive) { // stubbedæœ¬è´¨æ˜¯ä¸€ä¸ªLinkedList,è¿™é‡ŒæŠŠstubçš„ // è°ƒç”¨ï¼ˆinvocationï¼‰å’Œè¿”å›ï¼ˆanswerï¼‰ç»‘å®šï¼Œå¦‚æœåŒ¹é…åˆ°è°ƒç”¨ï¼Œå°±è¿”å›ç»‘å®šå€¼ stubbed.getFirst().addAnswer(answer); } else { stubbed.addFirst(new StubbedInvocationMatcher(invocationForStubbing, answer)); } } } å¦‚ä½•åŒ¹é…è°ƒç”¨æ–¹æ³•å‘¢ï¼Ÿé€šè¿‡handleæ–¹æ³•ï¼Œå°†è°ƒç”¨ä¸stubbedé“¾è¡¨è¿›è¡ŒåŒ¹é…æŸ¥è¯¢ï¼Œå¦‚æœæœ‰ç›¸åŒçš„è°ƒç”¨ï¼Œå°±è¿”å›è¯¥ç»‘å®šå€¼\npublic StubbedInvocationMatcher findAnswerFor(Invocation invocation) { synchronized (stubbed) { // æŸ¥è¯¢åŒ¹é…çš„è°ƒç”¨ for (StubbedInvocationMatcher s : stubbed) { if (s.matches(invocation)) { s.markStubUsed(invocation); invocation.markStubbed(new StubInfoImpl(s)); return s; } } } return null; } verify MockitoCore.verify\npublic \u0026lt;T\u0026gt; T verify(T mock, VerificationMode mode) { if (mock == null) { reporter.nullPassedToVerify(); } else if (!mockUtil.isMock(mock)) { reporter.notAMockPassedToVerify(mock.getClass()); } mockingProgress.verificationStarted(new MockAwareVerificationMode(mock, mode)); return mock; } mockitoæä¾›äº†å¤šç§VerificationMode,è¿™é‡Œä½¿ç”¨çš„æ˜¯Timesï¼Œå®ç°äº†VerificationModeç±»ï¼Œç”¨äºç»Ÿè®¡æ–¹æ³•æ‰§è¡Œæ¬¡æ•°ã€‚\n// Times public void verify(VerificationData data) { if (wantedCount \u0026gt; 0) { MissingInvocationChecker missingInvocation = new MissingInvocationChecker(); missingInvocation.check(data.getAllInvocations(), data.getWanted()); } NumberOfInvocationsChecker numberOfInvocations = new NumberOfInvocationsChecker(); numberOfInvocations.check(data.getAllInvocations(), data.getWanted(), wantedCount); } // NumberOfInvocationChecker public void check(List\u0026lt;Invocation\u0026gt; invocations, InvocationMatcher wanted, int wantedCount) { List\u0026lt;Invocation\u0026gt; actualInvocations = finder.findInvocations(invocations, wanted); int actualCount = actualInvocations.size(); if (wantedCount \u0026gt; actualCount) { Location lastInvocation = finder.getLastLocation(actualInvocations); reporter.tooLittleActualInvocations(new Discrepancy(wantedCount, actualCount), wanted, lastInvocation); } else if (wantedCount == 0 \u0026amp;\u0026amp; actualCount \u0026gt; 0) { Location firstUndesired = actualInvocations.get(wantedCount).getLocation(); reporter.neverWantedButInvoked(wanted, firstUndesired); } else if (wantedCount \u0026lt; actualCount) { Location firstUndesired = actualInvocations.get(wantedCount).getLocation(); reporter.tooManyActualInvocations(wantedCount, actualCount, wanted, firstUndesired); } invocationMarker.markVerified(actualInvocations, wanted); } å¦‚æœåˆ¤æ–­å¤±è´¥ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸\n","permalink":"https://zhongyi-byte.github.io/posts/tech/mockito%E7%AC%94%E8%AE%B0/","summary":"Mockitoå­¦ä¹ ç¬”è®° æ¦‚è¦ Mockitoæ˜¯ä¸€ä¸ªå¸¸è§ç”¨äºmockä¾èµ–å¯¹è±¡çš„æµ‹è¯•å·¥å…·ï¼Œæœ¬æ–‡é‡ç‚¹è®²è§£Mockitoçš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ä»¥åŠå®ç°åŸç†ã€‚ ä½¿ç”¨","title":"Mockitoç¬”è®°"},{"content":"æœç´¢å¼•æ“çš„æ ¸å¿ƒåœ¨äºæ ¹æ®**å…³é”®è¯ï¼ˆtermï¼‰æ‰¾åˆ°ç›¸å…³æ–‡æ¡£ï¼ˆdocumentï¼‰**çš„èƒ½åŠ›ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç›®çš„ï¼Œluceneé’ˆå¯¹æ¯ä¸ªtermç»´æŠ¤äº†ä¸€ä¸ªå€’æ’é“¾ï¼ˆpostingÂ listï¼‰ï¼Œå³åŒ…å«è¯¥termçš„docIdåˆ—è¡¨ã€‚\nä»€ä¹ˆæ˜¯å€’æ’ç´¢å¼• æ­£æ’ç´¢å¼• å³docIdÂ -Â documentçš„é”®å€¼å¯¹\ndocId name age 1 Jack 20 2 Bob 22 3 Jack 20 4 Alice 20 5 Jack 19 6 Bob 19 ç±»ä¼¼äºmysqlç´¢å¼•ï¼Œæ ¹æ®docIdå¯ä»¥æŸ¥è¯¢åˆ°ç›¸åº”çš„æ–‡æ¡£ä¿¡æ¯ã€‚\nå€’æ’ç´¢å¼• å€’æ’ç´¢å¼•æ˜¯å…³é”®è¯ï¼ˆtermï¼‰åˆ°æ–‡æ¡£idåˆ—è¡¨çš„æ˜ å°„å…³ç³»ã€‚ä¾‹å¦‚é’ˆå¯¹ä¸Šé¢è¿™å¼ è¡¨æ ¼ï¼Œå¯ä»¥å»ºç«‹ä¸¤ä¸ªå€’æ’ç´¢å¼•ï¼Œåˆ†åˆ«æ˜¯nameå’ŒageÂ Indexã€‚\nnameÂ index\ntermÂ dictionary postingÂ list Jack [1,3,5] Bob [2,6] Alice [4] ageÂ index\ntermÂ dictionary postingÂ list 19 [5,6] 20 [1,3,4] 22 [2] è¿™æ ·ï¼Œé’ˆå¯¹æ¯ä¸€ä¸ªå…³é”®è¯termï¼Œéƒ½å¯ä»¥æŸ¥è¯¢å‡ºå¯¹åº”çš„docIdåˆ—è¡¨ã€‚\nå¯¹termÂ dictionaryè¿›è¡Œæ’åºåï¼Œå¾—åˆ°ä¸€ä¸ªæœ‰åºçš„termåˆ—è¡¨ï¼Œå¯ä»¥é€šè¿‡äºŒåˆ†æ³•è¿›è¡ŒæŸ¥è¯¢ï¼Œè¿™æ ·çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(logN)ï¼Œç©ºé—´å¤æ‚åº¦æ˜¯O(N*len(key))ï¼Œå’Œtermæ•°é‡æˆæ­£æ¯”ã€‚å½“termæ•°é‡æä¸ºåºå¤§ï¼Œå†…å­˜é‡Œä¹Ÿæ”¾ä¸ä¸‹æ—¶ï¼Œéœ€è¦å¯¹termè¿›è¡Œç´¢å¼•æ¥æé«˜æ•ˆç‡ã€‚\nTermÂ Index Trieæ ‘ å‡è®¾å­—ç¬¦çš„ç§æ•°æœ‰mä¸ªï¼Œæœ‰è‹¥å¹²ä¸ªé•¿åº¦ä¸ºnçš„å­—ç¬¦ä¸²æ„æˆäº†ä¸€ä¸ªTrieæ ‘ï¼Œåˆ™æ¯ä¸ªèŠ‚ç‚¹çš„å‡ºåº¦ä¸ºmï¼ˆå³æ¯ä¸ªèŠ‚ç‚¹çš„å¯èƒ½å­èŠ‚ç‚¹æ•°é‡ä¸ºmï¼‰ï¼ŒTrieæ ‘çš„é«˜åº¦ä¸ºnã€‚å¾ˆæ˜æ˜¾æˆ‘ä»¬æµªè´¹äº†å¤§é‡çš„ç©ºé—´æ¥å­˜å‚¨å­—ç¬¦ï¼Œæ­¤æ—¶Trieæ ‘çš„æœ€åç©ºé—´å¤æ‚åº¦ä¸ºO(m^n)ã€‚ä¹Ÿæ­£ç”±äºæ¯ä¸ªèŠ‚ç‚¹çš„å‡ºåº¦ä¸ºmï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½å¤Ÿæ²¿ç€æ ‘çš„ä¸€ä¸ªä¸ªåˆ†æ”¯é«˜æ•ˆçš„å‘ä¸‹é€ä¸ªå­—ç¬¦çš„æŸ¥è¯¢ï¼Œè€Œä¸æ˜¯éå†æ‰€æœ‰çš„å­—ç¬¦ä¸²æ¥æŸ¥è¯¢ï¼Œæ­¤æ—¶Trieæ ‘çš„æœ€åæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚è¿™æ­£æ˜¯ç©ºé—´æ¢æ—¶é—´çš„ä½“ç°ï¼Œä¹Ÿæ˜¯åˆ©ç”¨å…¬å…±å‰ç¼€é™ä½æŸ¥è¯¢æ—¶é—´å¼€é”€çš„ä½“ç°ã€‚\nç›¸è¾ƒäºhashè¡¨ï¼Œtrieæ ‘æ”¯æŒåŠ¨æ€æŸ¥è¯¢ï¼Œå¯ä»¥è¿›è¡Œå‰ç¼€ï¼Œåç¼€ï¼ŒèŒƒå›´æŸ¥è¯¢ï¼Œåœ¨æœç´¢åœºæ™¯ä¸‹æ˜æ˜¾ä¼˜äºhashè¡¨ã€‚\nFSA FSAæ˜¯ä¸€ä¸ªFSM(æœ‰é™çŠ¶æ€æœº)çš„ä¸€ç§ï¼Œç‰¹æ€§å¦‚ä¸‹:\n*Â ç¡®å®šï¼šæ„å‘³ç€æŒ‡å®šä»»ä½•ä¸€ä¸ªçŠ¶æ€ï¼Œåªå¯èƒ½æœ€å¤šæœ‰ä¸€ä¸ªè½¬ç§»å¯ä»¥è®¿é—®åˆ°ã€‚\n*Â æ— ç¯ï¼šÂ ä¸å¯èƒ½é‡å¤éå†åŒä¸€ä¸ªçŠ¶æ€\n*Â æ¥æ”¶æœºï¼šæœ‰é™çŠ¶æ€æœºåªâ€œæ¥å—â€ç‰¹å®šçš„è¾“å…¥åºåˆ—ï¼Œå¹¶ç»ˆæ­¢äºfinalçŠ¶æ€ã€‚\näº‹å®ä¸Šå­—å…¸æ ‘ä¹Ÿæ˜¯ä¸€ç§FSAï¼Œä½†TRIEæ ‘åªå…±äº«å‰ç¼€ï¼Œè€ŒFSAä¸ä»…å…±äº«å‰ç¼€è¿˜å…±äº«åç¼€ã€‚å‡è®¾æˆ‘ä»¬ç”¨æ˜ŸæœŸä¸€ã€äºŒã€å››å»æ‰å…±åŒçš„dayåç¼€ç»„æˆä¸€ä¸ªSet:Â mon,tues,thursã€‚ç›¸åº”çš„TRIEæ˜¯è¿™æ ·çš„ï¼Œåªå…±äº«äº†å‰ç¼€ã€‚\nTRIEæœ‰é‡å¤çš„3ä¸ªfinalÂ state:3ã€8ã€11ã€‚Â è€Œ8ã€11éƒ½æ˜¯sè½¬ç§»ï¼Œæ˜¯å¯ä»¥åˆå¹¶çš„ï¼ŒFSAå…±äº«åç¼€åï¼š\nè¿›ä¸€æ­¥é™ä½äº†å­˜å‚¨ç©ºé—´ã€‚\nFST FSTç±»ä¼¼äºFSAï¼ŒåŒºåˆ«åœ¨äºç»™å®šä¸€ä¸ªkeyé™¤äº†èƒ½å›ç­”æ˜¯å¦å­˜åœ¨ï¼Œè¿˜èƒ½è¾“å‡ºä¸€ä¸ªå…³è”çš„å€¼ã€‚\nä¾ç„¶ä»¥mon,tues,thursè¿™ä¸ªé›†åˆä¸ºä¾‹ï¼Œä»¥æ˜ŸæœŸå¤©ä¸ºä¸€å‘¨çš„ç¬¬1å¤©ï¼Œæˆ‘ä»¬çš„monå¯¹åº”2ï¼Œtueså¯¹åº”3ï¼Œthurså¯¹åº”5ï¼Œé‚£ä¹ˆæœ€åç”Ÿæˆçš„FSTå°±å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ/åè¡¨ç¤ºè¦è¾“å‡ºçš„å€¼ï¼š\nè·¯å¾„m-\u0026gt;o-\u0026gt;nå°†ä¼šè¾“å‡º2\nè·¯å¾„t-\u0026gt;u-\u0026gt;e-\u0026gt;så°†ä¼šè¾“å‡º3\nè·¯å¾„t-\u0026gt;h-\u0026gt;u-\u0026gt;r-\u0026gt;så°†ä¼šè¾“å‡º5\nå½“ç„¶ï¼Œæ»¡è¶³ä¸Šè¯‰è¾“å‡ºæ¡ä»¶å¹¶ä¸åªæœ‰è¿™ä¸€ç§FSTï¼Œæ¯”å¦‚å¯ä»¥mÂ -\u0026gt;Â oÂ -\u0026gt;Â nçš„è·¯å¾„ä¸Šçš„m/2æ”¹æˆo/1\\`n/1`.\nå…³é”®ç‚¹åœ¨äºï¼šæ¯ä¸€ä¸ªkey,éƒ½åœ¨FSTä¸­å¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„è·¯å¾„ã€‚å› æ­¤ï¼Œå¯¹äºä»»ä½•ä¸€ä¸ªç‰¹å®šçš„keyï¼Œæ€»ä¼šæœ‰ä¸€äº›valueçš„ç»„åˆä½¿å¾—è·¯å¾„æ˜¯å”¯ä¸€çš„ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å¦‚ä½•æ¥åœ¨è½¬ç§»ä¸­åˆ†é…è¿™äº›ç»„åˆã€‚å¦‚ä½•æ„å»ºFSTç•™å¾…ä¸‹å‘¨ã€‚\né€šè¿‡FSTæ„å»ºtermÂ indexï¼Œå¯ä»¥å¤§å¤§é™ä½éœ€è¦çš„å­˜å‚¨ç©ºé—´ï¼Œä½¿termÂ indexå¯ä»¥è¢«ç¼“å­˜åˆ°å†…å­˜ä¸­ï¼ŒæŸ¥è¯¢æ—¶åªéœ€è¦åœ¨åŒ¹é…åˆ°termæ—¶è¿›è¡Œä¸€æ¬¡ç£ç›˜è®¿é—®ï¼Œé™ä½äº†ç£ç›˜æ“ä½œæ—¶é—´ã€‚\nè”åˆç´¢å¼•æŸ¥è¯¢ ä¾‹å¦‚å¯¹ä¸Šè¡¨è¿›è¡ŒÂ nameÂ ==Â \u0026lsquo;xx\u0026rsquo;Â andÂ ageÂ ==Â \u0026lsquo;yy\u0026rsquo;Â çš„æŸ¥è¯¢ï¼Œåœ¨mysqlæ•°æ®åº“ä¸­éœ€è¦å¯¹ageå’Œnameåˆ†åˆ«å»ºç«‹ç´¢å¼•ï¼ŒæŸ¥è¯¢ç»“æœåè¿›è¡Œåˆå¹¶ï¼Œæˆ–è€…å»ºç«‹è”åˆç´¢å¼•ã€‚\nè€Œå¯¹äºluceneæ¥è¯´ï¼Œå®é™…ä¸Šæ˜¯æ ¹æ®termæ‰¾åˆ°ç›¸åº”çš„å€’æ’é“¾ï¼Œå†å¯¹ä¸¤æ¡å€’æ’é“¾è¿›è¡Œåˆå¹¶ã€‚å€’æ’é“¾çš„æ•°æ®ç»“æ„æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œåˆ†åˆ«æ˜¯skiplistï¼ˆè·³è¡¨ï¼‰å’Œbitset\nSkipÂ List SkipListæœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹å¾ï¼š\nå…ƒç´ æ’åºçš„ï¼Œå¯¹åº”åˆ°æˆ‘ä»¬çš„å€’æ’é“¾ï¼Œluceneæ˜¯æŒ‰ç…§docidè¿›è¡Œæ’åºï¼Œä»å°åˆ°å¤§ã€‚\nè·³è·ƒæœ‰ä¸€ä¸ªå›ºå®šçš„é—´éš”ï¼Œè¿™ä¸ªæ˜¯éœ€è¦å»ºç«‹SkipListçš„æ—¶å€™æŒ‡å®šå¥½ï¼Œä¾‹å¦‚ä¸‹å›¾ä»¥é—´éš”æ˜¯3\nSkipListçš„å±‚æ¬¡ï¼Œè¿™ä¸ªæ˜¯æŒ‡æ•´ä¸ªSkipListæœ‰å‡ å±‚ æœ‰äº†è¿™ä¸ªSkipListä»¥åæ¯”å¦‚æˆ‘ä»¬è¦æŸ¥æ‰¾docid=12ï¼ŒåŸæ¥å¯èƒ½éœ€è¦ä¸€ä¸ªä¸ªæ‰«åŸå§‹é“¾è¡¨ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ5ï¼Œ7ï¼Œ8ï¼Œ10ï¼Œ12ã€‚æœ‰äº†SkipListä»¥åå…ˆè®¿é—®ç¬¬ä¸€å±‚çœ‹åˆ°æ˜¯ç„¶åå¤§äº12ï¼Œè¿›å…¥ç¬¬0å±‚èµ°åˆ°3ï¼Œ8ï¼Œå‘ç°15å¤§äº12ï¼Œç„¶åè¿›å…¥åŸé“¾è¡¨çš„8ç»§ç»­å‘ä¸‹ç»è¿‡10å’Œ12ã€‚\nSkipListæœ¬è´¨ä¸Šæ˜¯åœ¨æœ‰åºçš„é“¾è¡¨ä¸Šå®ç°å®ç°äºŒåˆ†æŸ¥æ‰¾ï¼Œå®ƒèƒ½æœ‰æ•ˆçš„æå‡é“¾è¡¨çš„æŸ¥æ‰¾æ•ˆç‡ï¼Œå…¶æ—¶é—´å¤æ‚åº¦ä¸ºO(logn)ï¼ˆå…¶ä¸­nä¸ºé“¾è¡¨é•¿åº¦ï¼‰ã€‚ç®€å•è¯´SkipListä¼˜åŒ–äº†Postingsçš„éšæœºæŸ¥æ‰¾çš„æ€§èƒ½é—®é¢˜ã€‚\nå‡å¦‚æˆ‘ä»¬æœ‰ä¸‹é¢ä¸‰ä¸ªå€’æ’é“¾éœ€è¦è¿›è¡Œåˆå¹¶ã€‚\nåœ¨luceneä¸­ä¼šé‡‡ç”¨ä¸‹åˆ—é¡ºåºè¿›è¡Œåˆå¹¶ï¼š\nåœ¨termAå¼€å§‹éå†ï¼Œå¾—åˆ°ç¬¬ä¸€ä¸ªå…ƒç´ docId=1\nSetÂ currentDocId=1\nåœ¨termBä¸­Â search(currentDocId)Â =Â 1Â (è¿”å›å¤§äºç­‰äºcurrentDocIdçš„ä¸€ä¸ªdoc),\nå› ä¸ºcurrentDocIdÂ ==1ï¼Œç»§ç»­\nå¦‚æœcurrentDocIdÂ å’Œè¿”å›çš„ä¸ç›¸ç­‰ï¼Œæ‰§è¡Œ2ï¼Œç„¶åç»§ç»­\nåˆ°termCåä¾ç„¶ç¬¦åˆï¼Œè¿”å›ç»“æœ\ncurrentDocIdÂ =Â termCçš„nextItem\nç„¶åç»§ç»­æ­¥éª¤3Â ä¾æ¬¡å¾ªç¯ã€‚ç›´åˆ°æŸä¸ªå€’æ’é“¾åˆ°æœ«å°¾ã€‚\næ•´ä¸ªåˆå¹¶æ­¥éª¤æˆ‘å¯ä»¥å‘ç°ï¼Œå¦‚æœæŸä¸ªé“¾å¾ˆçŸ­ï¼Œä¼šå¤§å¹…å‡å°‘æ¯”å¯¹æ¬¡æ•°ï¼Œå¹¶ä¸”ç”±äºSkipListç»“æ„çš„å­˜åœ¨ï¼Œåœ¨æŸä¸ªå€’æ’ä¸­å®šä½æŸä¸ªdocidçš„é€Ÿåº¦ä¼šæ¯”è¾ƒå¿«ä¸éœ€è¦ä¸€ä¸ªä¸ªéå†ã€‚å¯ä»¥å¾ˆå¿«çš„è¿”å›æœ€ç»ˆçš„ç»“æœã€‚ä»å€’æ’çš„å®šä½ï¼ŒæŸ¥è¯¢ï¼Œåˆå¹¶æ•´ä¸ªæµç¨‹ç»„æˆäº†luceneçš„æŸ¥è¯¢è¿‡ç¨‹ï¼Œå’Œä¼ ç»Ÿæ•°æ®åº“çš„ç´¢å¼•ç›¸æ¯”ï¼Œluceneåˆå¹¶è¿‡ç¨‹ä¸­çš„ä¼˜åŒ–å‡å°‘äº†è¯»å–æ•°æ®çš„IOï¼Œå€’æ’åˆå¹¶çš„çµæ´»æ€§ä¹Ÿè§£å†³äº†ä¼ ç»Ÿç´¢å¼•è¾ƒéš¾æ”¯æŒå¤šæ¡ä»¶æŸ¥è¯¢çš„é—®é¢˜ã€‚\nbitset bitsetÂ æ˜¯ä¸€ç§å¾ˆç›´è§‚çš„æ•°æ®ç»“æ„ï¼Œå¯¹åº”Â postingÂ listÂ å¦‚ï¼š[1,3,4,7,10]\nå¯¹åº”çš„Â bitsetÂ å°±æ˜¯ï¼šÂ [1,0,1,1,0,0,1,0,0,1]Â ï¼Œæ¯ä¸ªæ–‡æ¡£æŒ‰ç…§æ–‡æ¡£Â idÂ æ’åºå¯¹åº”å…¶ä¸­çš„ä¸€ä¸ªÂ bitã€‚BitsetÂ è‡ªèº«å°±æœ‰å‹ç¼©çš„ç‰¹ç‚¹ï¼Œå…¶ç”¨ä¸€ä¸ªÂ byteÂ å°±å¯ä»¥ä»£è¡¨Â 8Â ä¸ªæ–‡æ¡£ã€‚æ‰€ä»¥Â 100Â ä¸‡ä¸ªæ–‡æ¡£åªéœ€è¦Â 12.5Â ä¸‡ä¸ªÂ byteã€‚ä½†æ˜¯è€ƒè™‘åˆ°æ–‡æ¡£å¯èƒ½æœ‰æ•°åäº¿ä¹‹å¤šï¼Œåœ¨å†…å­˜é‡Œä¿å­˜Â bitsetÂ ä»ç„¶æ˜¯å¾ˆå¥¢ä¾ˆçš„äº‹æƒ…ã€‚è€Œä¸”å¯¹äºä¸ªæ¯ä¸€ä¸ªÂ filterÂ éƒ½è¦æ¶ˆè€—ä¸€ä¸ªÂ bitsetï¼Œæ¯”å¦‚Â age=18Â ç¼“å­˜èµ·æ¥çš„è¯æ˜¯ä¸€ä¸ªÂ bitsetï¼Œ18\u0026lt;=age\u0026lt;25Â æ˜¯å¦å¤–ä¸€ä¸ªÂ filterÂ ç¼“å­˜èµ·æ¥ä¹Ÿè¦ä¸€ä¸ªÂ bitsetã€‚Â LuceneÂ ä¼šå¯¹bitsetå†è¿›è¡Œå‹ç¼©ï¼Œç§°ä¹‹ä¸ºÂ RoaringÂ Bitmapã€‚å‹ç¼©çš„æ€è·¯å…¶å®å¾ˆç®€å•ã€‚ä¸å…¶ä¿å­˜Â 100Â ä¸ªÂ 0ï¼Œå ç”¨Â 100Â ä¸ªÂ bitã€‚è¿˜ä¸å¦‚ä¿å­˜Â 0Â ä¸€æ¬¡ï¼Œç„¶åå£°æ˜è¿™ä¸ªÂ 0Â é‡å¤äº†Â 100Â éã€‚\nè¿™ä¸¤ç§åˆå¹¶ä½¿ç”¨ç´¢å¼•çš„æ–¹å¼éƒ½æœ‰å…¶ç”¨é€”ã€‚ElasticsearchÂ å¯¹å…¶æ€§èƒ½æœ‰è¯¦ç»†çš„å¯¹æ¯”ã€‚ç®€å•æ¥è¯´å¯¹äºç®€å•çš„ç›¸ç­‰æ¡ä»¶çš„è¿‡æ»¤ç¼“å­˜æˆçº¯å†…å­˜çš„Â bitsetÂ è¿˜ä¸å¦‚éœ€è¦è®¿é—®ç£ç›˜çš„Â skipÂ listÂ çš„æ–¹å¼è¦å¿«ã€‚\n","permalink":"https://zhongyi-byte.github.io/posts/tech/lucene%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","summary":"æœç´¢å¼•æ“çš„æ ¸å¿ƒåœ¨äºæ ¹æ®**å…³é”®è¯ï¼ˆtermï¼‰æ‰¾åˆ°ç›¸å…³æ–‡æ¡£ï¼ˆdocumentï¼‰**çš„èƒ½åŠ›ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç›®çš„ï¼Œluceneé’ˆå¯¹æ¯ä¸ªtermç»´æŠ¤äº†","title":"Luceneå­¦ä¹ ç¬”è®°"},{"content":"èŠ±äº†ä¸¤ä¸ªæ™šä¸Šçš„æ—¶é—´æ­å»ºå¥½äº†è¿™ä¸ªåšå®¢ã€‚è®°å½•ä¸‹è¿‡ç¨‹ï¼š\nå‚è€ƒsulvçš„å»ºç«™æ•™ç¨‹ï¼Œç”¨ä»–çš„ä»£ç ç”Ÿæˆäº†æˆ‘çš„ç¬¬ä¸€ç‰ˆåšå®¢ã€‚ç„¶åæ ¹æ®ä¸ªäººä¿¡æ¯ä½œäº†ä¸€äº›é…ç½® é€šè¿‡dockeræ­å»ºtwikooæœåŠ¡ï¼Œæä¾›äº†è¯„è®ºåŠŸèƒ½ï¼Œä¸è¿‡ç›®å‰dockerè¿è¡Œåœ¨æœ¬åœ°æœºå™¨ä¸Šï¼Œæ—¶ä¸æ—¶å°±ä¼šå…³æ‰ï¼Œå°†æ¥æ¢åˆ°äº‘æœåŠ¡å™¨ä¸Šã€‚\nä¸è¿‡æˆ‘å¯¹twikooä¸å¤ªæ»¡æ„ï¼Œæˆ‘é¢„æœŸä¸­çš„è¯„è®ºåº”è¯¥èƒ½å’Œgithubè´¦å·è”åŠ¨ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„è´¦å·ã€‚ å°†åšå®¢éƒ¨ç½²åˆ°github pageä¸Šï¼Œæš‚ä¸”å…ˆç”¨ç€().github.ioçš„åŸŸåï¼Œä»¥åæ¢æˆè‡ªå·±çš„ã€‚ åˆ©ç”¨github actionï¼Œå®ç°åšå®¢è‡ªåŠ¨å‘å¸ƒéƒ¨ç½²ã€‚ å°†è¯„è®ºæ›¿æ¢ä¸ºgiscusï¼Œå®ç°ä¸githubè”åŠ¨ã€‚\næ ¹æ®ä¸ªäººä¿¡æ¯é…ç½®å¥½åï¼Œå°†scriptè¯­å¥å¤åˆ¶åˆ°/layouts/partials/comments.htmlä¸­ã€‚ \u0026lt;!-- giscus --\u0026gt; \u0026lt;div\u0026gt; \u0026lt;div id=\u0026#34;tcomment\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;script src=\u0026#34;https://giscus.app/client.js\u0026#34; data-repo=\u0026#34;\u0026#34; //å¡«å†™è‡ªå·±çš„ä»“åº“åœ°å€ data-repo-id=\u0026#34;\u0026#34; //repoId data-category=\u0026#34;Announcements\u0026#34; //è¯„è®ºç±»å‹ï¼Œå‚ç…§githubçš„discussion data-category-id=\u0026#34;DIC_kwDOIAW3Os4CReNg\u0026#34; data-mapping=\u0026#34;url\u0026#34; data-strict=\u0026#34;0\u0026#34; data-reactions-enabled=\u0026#34;1\u0026#34; data-emit-metadata=\u0026#34;0\u0026#34; data-input-position=\u0026#34;top\u0026#34; data-theme=\u0026#34;preferred_color_scheme\u0026#34; data-lang=\u0026#34;zh-CN\u0026#34; //ä¸­æ–‡ data-loading=\u0026#34;lazy\u0026#34; //æ‡’åŠ è½½ crossorigin=\u0026#34;anonymous\u0026#34; async\u0026gt; \u0026lt;/script\u0026gt; \u0026lt;/div\u0026gt; ä»¥ä¸Šè¯­å¥å¯ä»¥åœ¨ gitcusä¸­è‡ªåŠ¨ç”Ÿæˆã€‚ è°ƒç”¨ä¸Šè¿°giscusä»£ç çš„ä½ç½®ï¼šlayouts/_default/single.html\n\u0026lt;article class=\u0026#34;post-single\u0026#34;\u0026gt; // è¿™é‡Œæ˜¯é»˜è®¤çš„å…¶ä»–ä»£ç  // giscusï¼Œä¸€èˆ¬åªéœ€è¦å¤åˆ¶ä»¥ä¸‹3è¡Œä»£ç ï¼ŒåŠ ä¸Šå…¶ä»–ä»£ç æ˜¯ä¸ºäº†å¸®åŠ©è¯»è€…ç¡®è®¤ä»£ç æ·»åŠ çš„ä½ç½® {{- if (.Param \u0026#34;comments\u0026#34;) }} {{- partial \u0026#34;comments.html\u0026#34; . }} {{- end }} \u0026lt;/article\u0026gt; å‚è€ƒ Hugoåšå®¢æ­å»º Hugo + GitHub Actionï¼Œæ­å»ºä½ çš„åšå®¢è‡ªåŠ¨å‘å¸ƒç³»ç»Ÿ gitcus ","permalink":"https://zhongyi-byte.github.io/posts/blog/%E5%BB%BA%E7%AB%99%E8%AE%B0%E5%BD%95/","summary":"èŠ±äº†ä¸¤ä¸ªæ™šä¸Šçš„æ—¶é—´æ­å»ºå¥½äº†è¿™ä¸ªåšå®¢ã€‚è®°å½•ä¸‹è¿‡ç¨‹ï¼š å‚è€ƒsulvçš„å»ºç«™æ•™ç¨‹ï¼Œç”¨ä»–çš„ä»£ç ç”Ÿæˆäº†æˆ‘çš„ç¬¬ä¸€ç‰ˆåšå®¢ã€‚ç„¶åæ ¹æ®ä¸ªäººä¿¡æ¯ä½œäº†ä¸€äº›é…ç½® é€šè¿‡do","title":"å»ºç«™è®°å½•"},{"content":"","permalink":"https://zhongyi-byte.github.io/posts/life/%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%86%99%E5%8D%9A%E5%AE%A2/","summary":"","title":"ä¸ºä»€ä¹ˆè¦å†™åšå®¢"},{"content":"","permalink":"https://zhongyi-byte.github.io/posts/blog/blog/","summary":"","title":"Blog"},{"content":"","permalink":"https://zhongyi-byte.github.io/posts/life/life/","summary":"","title":"Life"},{"content":"","permalink":"https://zhongyi-byte.github.io/posts/read/read/","summary":"","title":"Read"},{"content":"","permalink":"https://zhongyi-byte.github.io/posts/tech/tech/","summary":"","title":"Tech"},{"content":" Sulv\u0026#39;s Blog ä¸€ä¸ªè®°å½•æŠ€æœ¯ã€é˜…è¯»ã€ç”Ÿæ´»çš„åšå®¢ ğŸ‘‰å‹é“¾æ ¼å¼ åç§°ï¼š Sulv\u0026rsquo;s Blog ç½‘å€ï¼š https://www.sulvblog.cn å›¾æ ‡ï¼š https://www.sulvblog.cn/img/Q.gif æè¿°ï¼š ä¸€ä¸ªè®°å½•æŠ€æœ¯ã€é˜…è¯»ã€ç”Ÿæ´»çš„åšå®¢ ğŸ‘‰å‹é“¾ç”³è¯·è¦æ±‚ ç§‰æ‰¿äº’æ¢å‹é“¾åŸåˆ™ã€æ–‡ç« å®šæœŸæ›´æ–°ã€ä¸èƒ½æœ‰å¤ªå¤šå¹¿å‘Šã€ä¸ªäººæè¿°å­—æ•°æ§åˆ¶åœ¨15å­—å†…\nğŸ‘‰Hugoåšå®¢äº¤æµç¾¤ 787018782\n","permalink":"https://zhongyi-byte.github.io/links/","summary":"Sulv\u0026#39;s Blog ä¸€ä¸ªè®°å½•æŠ€æœ¯ã€é˜…è¯»ã€ç”Ÿæ´»çš„åšå®¢ ğŸ‘‰å‹é“¾æ ¼å¼ åç§°ï¼š Sulv\u0026rsquo;s Blog ç½‘å€ï¼š https://www.sulvblog.cn å›¾æ ‡ï¼š https://www.sulvblog.cn/img/Q.gif æè¿°ï¼š ä¸€ä¸ªè®°å½•æŠ€æœ¯ã€é˜…è¯»ã€ç”Ÿæ´»çš„åšå®¢ ğŸ‘‰å‹é“¾ç”³è¯·è¦æ±‚ ç§‰æ‰¿äº’æ¢å‹é“¾åŸåˆ™ã€æ–‡","title":"ğŸ¤å‹é“¾"},{"content":"å…³äºæˆ‘\nè‹±æ–‡å: Zyi èŒä¸š: ç¨‹åºå‘˜ è¿åŠ¨: ç¾½æ¯›çƒï¼Œå°„ç®­ï¼Œéª‘è½¦ ","permalink":"https://zhongyi-byte.github.io/about/","summary":"å…³äºæˆ‘ è‹±æ–‡å: Zyi èŒä¸š: ç¨‹åºå‘˜ è¿åŠ¨: ç¾½æ¯›çƒï¼Œå°„ç®­ï¼Œéª‘è½¦","title":"ğŸ™‹ğŸ»â€â™‚ï¸å…³äº"}]